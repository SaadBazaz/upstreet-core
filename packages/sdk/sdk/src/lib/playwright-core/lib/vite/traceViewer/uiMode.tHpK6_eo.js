function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./assets/xtermModule-BeNbaIVa.js","./xtermModule.DSXBckUd.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{u as Ot,r as K,b as Wt,_ as At,d as Ut,e as zt,j as n,R as c,E as Vt,s as mt,f as it,m as Kt,g as H,T as L,h as Ht,i as $t,k as ht,W as qt,M as Yt,l as tt,n as Qt,S as Xt,o as Gt,a as Jt,c as Zt}from"./assets/workbench-Cg317xps.js";import{T as te,W as ee}from"./assets/testServerConnection-DeE2kSzz.js";var se={};class et{constructor(t,e={}){this.isListing=!1,this._tests=new Map,this._rootSuite=new $("","root"),this._options=e,this._reporter=t}reset(){this._rootSuite._entries=[],this._tests.clear()}dispatch(t){const{method:e,params:s}=t;if(e==="onConfigure"){this._onConfigure(s.config);return}if(e==="onProject"){this._onProject(s.project);return}if(e==="onBegin"){this._onBegin();return}if(e==="onTestBegin"){this._onTestBegin(s.testId,s.result);return}if(e==="onTestEnd"){this._onTestEnd(s.test,s.result);return}if(e==="onStepBegin"){this._onStepBegin(s.testId,s.resultId,s.step);return}if(e==="onStepEnd"){this._onStepEnd(s.testId,s.resultId,s.step);return}if(e==="onError"){this._onError(s.error);return}if(e==="onStdIO"){this._onStdIO(s.type,s.testId,s.resultId,s.data,s.isBase64);return}if(e==="onEnd")return this._onEnd(s.result);if(e==="onExit")return this._onExit()}_onConfigure(t){var e,s;this._rootDir=t.rootDir,this._config=this._parseConfig(t),(s=(e=this._reporter).onConfigure)==null||s.call(e,this._config)}_onProject(t){let e=this._options.mergeProjects?this._rootSuite.suites.find(s=>s.project().name===t.name):void 0;e||(e=new $(t.name,"project"),this._rootSuite._addSuite(e)),e._project=this._parseProject(t);for(const s of t.suites)this._mergeSuiteInto(s,e)}_onBegin(){var t,e;(e=(t=this._reporter).onBegin)==null||e.call(t,this._rootSuite)}_onTestBegin(t,e){var l,a;const s=this._tests.get(t);this._options.clearPreviousResultsWhenTestBegins&&(s.results=[]);const o=s._createTestResult(e.id);o.retry=e.retry,o.workerIndex=e.workerIndex,o.parallelIndex=e.parallelIndex,o.setStartTimeNumber(e.startTime),(a=(l=this._reporter).onTestBegin)==null||a.call(l,s,o)}_onTestEnd(t,e){var l,a,m;const s=this._tests.get(t.testId);s.timeout=t.timeout,s.expectedStatus=t.expectedStatus,s.annotations=t.annotations;const o=s.results.find(r=>r._id===e.id);o.duration=e.duration,o.status=e.status,o.errors=e.errors,o.error=(l=o.errors)==null?void 0:l[0],o.attachments=this._parseAttachments(e.attachments),(m=(a=this._reporter).onTestEnd)==null||m.call(a,s,o),o._stepMap=new Map}_onStepBegin(t,e,s){var f,d;const o=this._tests.get(t),l=o.results.find(p=>p._id===e),a=s.parentStepId?l._stepMap.get(s.parentStepId):void 0,m=this._absoluteLocation(s.location),r=new oe(s,a,m);a?a.steps.push(r):l.steps.push(r),l._stepMap.set(s.id,r),(d=(f=this._reporter).onStepBegin)==null||d.call(f,o,l,r)}_onStepEnd(t,e,s){var m,r;const o=this._tests.get(t),l=o.results.find(f=>f._id===e),a=l._stepMap.get(s.id);a.duration=s.duration,a.error=s.error,(r=(m=this._reporter).onStepEnd)==null||r.call(m,o,l,a)}_onError(t){var e,s;(s=(e=this._reporter).onError)==null||s.call(e,t)}_onStdIO(t,e,s,o,l){var f,d,p,k;const a=l?globalThis.Buffer?Buffer.from(o,"base64"):atob(o):o,m=e?this._tests.get(e):void 0,r=m&&s?m.results.find(h=>h._id===s):void 0;t==="stdout"?(r==null||r.stdout.push(a),(d=(f=this._reporter).onStdOut)==null||d.call(f,a,m,r)):(r==null||r.stderr.push(a),(k=(p=this._reporter).onStdErr)==null||k.call(p,a,m,r))}async _onEnd(t){var e,s;await((s=(e=this._reporter).onEnd)==null?void 0:s.call(e,{status:t.status,startTime:new Date(t.startTime),duration:t.duration}))}_onExit(){var t,e;return(e=(t=this._reporter).onExit)==null?void 0:e.call(t)}_parseConfig(t){const e={...ne,...t};return this._options.configOverrides&&(e.configFile=this._options.configOverrides.configFile,e.reportSlowTests=this._options.configOverrides.reportSlowTests,e.quiet=this._options.configOverrides.quiet,e.reporter=[...this._options.configOverrides.reporter]),e}_parseProject(t){return{metadata:t.metadata,name:t.name,outputDir:this._absolutePath(t.outputDir),repeatEach:t.repeatEach,retries:t.retries,testDir:this._absolutePath(t.testDir),testIgnore:G(t.testIgnore),testMatch:G(t.testMatch),timeout:t.timeout,grep:G(t.grep),grepInvert:G(t.grepInvert),dependencies:t.dependencies,teardown:t.teardown,snapshotDir:this._absolutePath(t.snapshotDir),use:{}}}_parseAttachments(t){return t.map(e=>({...e,body:e.base64&&globalThis.Buffer?Buffer.from(e.base64,"base64"):void 0}))}_mergeSuiteInto(t,e){let s=e.suites.find(o=>o.title===t.title);s||(s=new $(t.title,e.type==="project"?"file":"describe"),e._addSuite(s)),s.location=this._absoluteLocation(t.location),t.entries.forEach(o=>{"testId"in o?this._mergeTestInto(o,s):this._mergeSuiteInto(o,s)})}_mergeTestInto(t,e){let s=this._options.mergeTestCases?e.tests.find(o=>o.title===t.title&&o.repeatEachIndex===t.repeatEachIndex):void 0;s||(s=new ie(t.testId,t.title,this._absoluteLocation(t.location),t.repeatEachIndex),e._addTest(s),this._tests.set(s.id,s)),this._updateTest(t,s)}_updateTest(t,e){return e.id=t.testId,e.location=this._absoluteLocation(t.location),e.retries=t.retries,e.tags=t.tags??[],e.annotations=t.annotations??[],e}_absoluteLocation(t){return t&&{...t,file:this._absolutePath(t.file)}}_absolutePath(t){if(t!==void 0)return this._options.resolvePath?this._options.resolvePath(this._rootDir,t):this._rootDir+"/"+t}}class ${constructor(t,e){this._entries=[],this._requireFile="",this._parallelMode="none",this.title=t,this._type=e}get type(){return this._type}get suites(){return this._entries.filter(t=>t.type!=="test")}get tests(){return this._entries.filter(t=>t.type==="test")}entries(){return this._entries}allTests(){const t=[],e=s=>{for(const o of s.entries())o.type==="test"?t.push(o):e(o)};return e(this),t}titlePath(){const t=this.parent?this.parent.titlePath():[];return(this.title||this._type!=="describe")&&t.push(this.title),t}project(){var t;return this._project??((t=this.parent)==null?void 0:t.project())}_addTest(t){t.parent=this,this._entries.push(t)}_addSuite(t){t.parent=this,this._entries.push(t)}}class ie{constructor(t,e,s,o){this.fn=()=>{},this.results=[],this.type="test",this.expectedStatus="passed",this.timeout=0,this.annotations=[],this.retries=0,this.tags=[],this.repeatEachIndex=0,this.id=t,this.title=e,this.location=s,this.repeatEachIndex=o}titlePath(){const t=this.parent?this.parent.titlePath():[];return t.push(this.title),t}outcome(){return ae(this)}ok(){const t=this.outcome();return t==="expected"||t==="flaky"||t==="skipped"}_createTestResult(t){const e=new re(this.results.length,t);return this.results.push(e),e}}class oe{constructor(t,e,s){this.duration=-1,this.steps=[],this._startTime=0,this.title=t.title,this.category=t.category,this.location=s,this.parent=e,this._startTime=t.startTime}titlePath(){var e;return[...((e=this.parent)==null?void 0:e.titlePath())||[],this.title]}get startTime(){return new Date(this._startTime)}set startTime(t){this._startTime=+t}}class re{constructor(t,e){this.parallelIndex=-1,this.workerIndex=-1,this.duration=-1,this.stdout=[],this.stderr=[],this.attachments=[],this.status="skipped",this.steps=[],this.errors=[],this._stepMap=new Map,this._startTime=0,this.retry=t,this._id=e}setStartTimeNumber(t){this._startTime=t}get startTime(){return new Date(this._startTime)}set startTime(t){this._startTime=+t}}const ne={forbidOnly:!1,fullyParallel:!1,globalSetup:null,globalTeardown:null,globalTimeout:0,grep:/.*/,grepInvert:null,maxFailures:0,metadata:{},preserveOutput:"always",projects:[],reporter:[[se.CI?"dot":"list"]],reportSlowTests:{max:5,threshold:15e3},configFile:"",rootDir:"",quiet:!1,shard:null,updateSnapshots:"missing",version:"",workers:0,webServer:null};function G(i){return i.map(t=>t.s!==void 0?t.s:new RegExp(t.r.source,t.r.flags))}function ae(i){let t=0,e=0,s=0;for(const o of i.results)o.status==="interrupted"||(o.status==="skipped"&&i.expectedStatus==="skipped"?++t:o.status==="skipped"||(o.status===i.expectedStatus?++e:++s));return e===0&&s===0?"skipped":s===0?"expected":e===0&&t===0?"unexpected":"flaky"}class st{constructor(t,e,s,o,l){this._treeItemById=new Map,this._treeItemByTestId=new Map;const a=o&&[...o.values()].some(Boolean);this.pathSeparator=l,this.rootItem={kind:"group",subKind:"folder",id:t,title:"",location:{file:"",line:0,column:0},duration:0,parent:void 0,children:[],status:"none",hasLoadErrors:!1},this._treeItemById.set(t,this.rootItem);const m=(r,f,d)=>{for(const p of f.suites){const k=p.title||"<anonymous>";let h=d.children.find(g=>g.kind==="group"&&g.title===k);h||(h={kind:"group",subKind:"describe",id:"suite:"+f.titlePath().join("")+""+k,title:k,location:p.location,duration:0,parent:d,children:[],status:"none",hasLoadErrors:!1},this._addChild(d,h)),m(r,p,h)}for(const p of f.tests){const k=p.title;let h=d.children.find(T=>T.kind!=="group"&&T.title===k);h||(h={kind:"case",id:"test:"+p.titlePath().join(""),title:k,parent:d,children:[],tests:[],location:p.location,duration:0,status:"none",project:void 0,test:void 0,tags:p.tags},this._addChild(d,h));const g=p.results[0];let v="none";(g==null?void 0:g[q])==="scheduled"?v="scheduled":(g==null?void 0:g[q])==="running"?v="running":(g==null?void 0:g.status)==="skipped"?v="skipped":(g==null?void 0:g.status)==="interrupted"?v="none":g&&p.outcome()!=="expected"?v="failed":g&&p.outcome()==="expected"&&(v="passed"),h.tests.push(p);const B={kind:"test",id:p.id,title:r.name,location:p.location,test:p,parent:h,children:[],status:v,duration:p.results.length?Math.max(0,p.results[0].duration):0,project:r};this._addChild(h,B),this._treeItemByTestId.set(p.id,B),h.duration=h.children.reduce((T,y)=>T+y.duration,0)}};for(const r of(e==null?void 0:e.suites)||[])if(!(a&&!o.get(r.title)))for(const f of r.suites){const d=this._fileItem(f.location.file.split(l),!0);m(r.project(),f,d)}for(const r of s){if(!r.location)continue;const f=this._fileItem(r.location.file.split(l),!0);f.hasLoadErrors=!0}}_addChild(t,e){t.children.push(e),e.parent=t,this._treeItemById.set(e.id,e)}filterTree(t,e,s){const o=t.trim().toLowerCase().split(" "),l=[...e.values()].some(Boolean),a=r=>{const f=[...r.tests[0].titlePath(),...r.tests[0].tags].join(" ").toLowerCase();return!o.every(d=>f.includes(d))&&!r.tests.some(d=>s==null?void 0:s.has(d.id))?!1:(r.children=r.children.filter(d=>!l||(s==null?void 0:s.has(d.test.id))||e.get(d.status)),r.tests=r.children.map(d=>d.test),!!r.children.length)},m=r=>{const f=[];for(const d of r.children)d.kind==="case"?a(d)&&f.push(d):(m(d),(d.children.length||d.hasLoadErrors)&&f.push(d));r.children=f};m(this.rootItem)}_fileItem(t,e){if(t.length===0)return this.rootItem;const s=t.join(this.pathSeparator),o=this._treeItemById.get(s);if(o)return o;const l=this._fileItem(t.slice(0,t.length-1),!1),a={kind:"group",subKind:e?"file":"folder",id:s,title:t[t.length-1],location:{file:s,line:0,column:0},duration:0,parent:l,children:[],status:"none",hasLoadErrors:!1};return this._addChild(l,a),a}sortAndPropagateStatus(){wt(this.rootItem)}flattenForSingleProject(){const t=e=>{e.kind==="case"&&e.children.length===1?(e.project=e.children[0].project,e.test=e.children[0].test,e.children=[],this._treeItemByTestId.set(e.test.id,e)):e.children.forEach(t)};t(this.rootItem)}shortenRoot(){let t=this.rootItem;for(;t.children.length===1&&t.children[0].kind==="group"&&t.children[0].subKind==="folder";)t=t.children[0];t.location=this.rootItem.location,this.rootItem=t}testIds(){const t=new Set,e=s=>{s.kind==="case"&&s.tests.forEach(o=>t.add(o.id)),s.children.forEach(e)};return e(this.rootItem),t}fileNames(){const t=new Set,e=s=>{s.kind==="group"&&s.subKind==="file"?t.add(s.id):s.children.forEach(e)};return e(this.rootItem),[...t]}flatTreeItems(){const t=[],e=s=>{t.push(s),s.children.forEach(e)};return e(this.rootItem),t}treeItemById(t){return this._treeItemById.get(t)}collectTestIds(t){return t?le(t):new Set}}function wt(i){for(const a of i.children)wt(a);i.kind==="group"&&i.children.sort((a,m)=>a.location.file.localeCompare(m.location.file)||a.location.line-m.location.line);let t=i.children.length>0,e=i.children.length>0,s=!1,o=!1,l=!1;for(const a of i.children)e=e&&a.status==="skipped",t=t&&(a.status==="passed"||a.status==="skipped"),s=s||a.status==="failed",o=o||a.status==="running",l=l||a.status==="scheduled";o?i.status="running":l?i.status="scheduled":s?i.status="failed":e?i.status="skipped":t&&(i.status="passed")}function le(i){const t=new Set,e=s=>{var o;s.kind==="case"?s.tests.map(l=>l.id).forEach(l=>t.add(l)):s.kind==="test"?t.add(s.id):(o=s.children)==null||o.forEach(e)};return e(i),t}const q=Symbol("statusEx");class ce{constructor(t){this.loadErrors=[],this.progress={total:0,passed:0,failed:0,skipped:0},this._lastRunTestCount=0,this._receiver=new et(this._createReporter(),{mergeProjects:!0,mergeTestCases:!0,resolvePath:(e,s)=>e+t.pathSeparator+s,clearPreviousResultsWhenTestBegins:!0}),this._options=t}_createReporter(){return{version:()=>"v2",onConfigure:t=>{this.config=t,this._lastRunReceiver=new et({onBegin:e=>{this._lastRunTestCount=e.allTests().length,this._lastRunReceiver=void 0}},{mergeProjects:!0,mergeTestCases:!1,resolvePath:(e,s)=>e+this._options.pathSeparator+s})},onBegin:t=>{var e;if(this.rootSuite||(this.rootSuite=t),this._testResultsSnapshot){for(const s of this.rootSuite.allTests())s.results=((e=this._testResultsSnapshot)==null?void 0:e.get(s.id))||s.results;this._testResultsSnapshot=void 0}this.progress.total=this._lastRunTestCount,this.progress.passed=0,this.progress.failed=0,this.progress.skipped=0,this._options.onUpdate(!0)},onEnd:()=>{this._options.onUpdate(!0)},onTestBegin:(t,e)=>{e[q]="running",this._options.onUpdate()},onTestEnd:(t,e)=>{t.outcome()==="skipped"?++this.progress.skipped:t.outcome()==="unexpected"?++this.progress.failed:++this.progress.passed,e[q]=e.status,this._options.onUpdate()},onError:t=>this._handleOnError(t),printsToStdio:()=>!1,onStdOut:()=>{},onStdErr:()=>{},onExit:()=>{},onStepBegin:()=>{},onStepEnd:()=>{}}}processGlobalReport(t){const e=new et({onConfigure:s=>{this.config=s},onError:s=>this._handleOnError(s)});for(const s of t)e.dispatch(s)}processListReport(t){var s;const e=((s=this.rootSuite)==null?void 0:s.allTests())||[];this._testResultsSnapshot=new Map(e.map(o=>[o.id,o.results])),this._receiver.reset();for(const o of t)this._receiver.dispatch(o)}processTestReportEvent(t){var e,s,o;(s=(e=this._lastRunReceiver)==null?void 0:e.dispatch(t))==null||s.catch(()=>{}),(o=this._receiver.dispatch(t))==null||o.catch(()=>{})}_handleOnError(t){var e,s;this.loadErrors.push(t),(s=(e=this._options).onError)==null||s.call(e,t),this._options.onUpdate()}asModel(){return{rootSuite:this.rootSuite||new $("","root"),config:this.config,loadErrors:this.loadErrors,progress:this.progress}}}const ue=({source:i})=>{const[t,e]=Ot(),[s,o]=K.useState(Wt()),[l]=K.useState(At(()=>import("./assets/xtermModule-BeNbaIVa.js"),__vite__mapDeps([0,1]),import.meta.url).then(m=>m.default)),a=K.useRef(null);return K.useEffect(()=>(Ut(o),()=>zt(o)),[]),K.useEffect(()=>{const m=i.write,r=i.clear;return(async()=>{const{Terminal:f,FitAddon:d}=await l,p=e.current;if(!p)return;const k=s==="dark-mode"?he:de;if(a.current&&a.current.terminal.options.theme===k)return;a.current&&(p.textContent="");const h=new f({convertEol:!0,fontSize:13,scrollback:1e4,fontFamily:"var(--vscode-editor-font-family)",theme:k}),g=new d;h.loadAddon(g);for(const v of i.pending)h.write(v);i.write=v=>{i.pending.push(v),h.write(v)},i.clear=()=>{i.pending=[],h.clear()},h.open(p),g.fit(),a.current={terminal:h,fitAddon:g}})(),()=>{i.clear=r,i.write=m}},[l,a,e,i,s]),K.useEffect(()=>{setTimeout(()=>{a.current&&(a.current.fitAddon.fit(),i.resize(a.current.terminal.cols,a.current.terminal.rows))},250)},[t,i]),n.jsx("div",{"data-testid":"output",className:"xterm-wrapper",style:{flex:"auto"},ref:e})},de={foreground:"#383a42",background:"#fafafa",cursor:"#383a42",black:"#000000",red:"#e45649",green:"#50a14f",yellow:"#c18401",blue:"#4078f2",magenta:"#a626a4",cyan:"#0184bc",white:"#a0a0a0",brightBlack:"#000000",brightRed:"#e06c75",brightGreen:"#98c379",brightYellow:"#d19a66",brightBlue:"#4078f2",brightMagenta:"#a626a4",brightCyan:"#0184bc",brightWhite:"#383a42",selectionBackground:"#d7d7d7",selectionForeground:"#383a42"},he={foreground:"#f8f8f2",background:"#1e1e1e",cursor:"#f8f8f0",black:"#000000",red:"#ff5555",green:"#50fa7b",yellow:"#f1fa8c",blue:"#bd93f9",magenta:"#ff79c6",cyan:"#8be9fd",white:"#bfbfbf",brightBlack:"#4d4d4d",brightRed:"#ff6e6e",brightGreen:"#69ff94",brightYellow:"#ffffa5",brightBlue:"#d6acff",brightMagenta:"#ff92df",brightCyan:"#a4ffff",brightWhite:"#e6e6e6",selectionBackground:"#44475a",selectionForeground:"#f8f8f2"},fe=({filterText:i,setFilterText:t,statusFilters:e,setStatusFilters:s,projectFilters:o,setProjectFilters:l,testModel:a,runTests:m})=>{const[r,f]=c.useState(!1),d=c.useRef(null);c.useEffect(()=>{var h;(h=d.current)==null||h.focus()},[]);const p=[...e.entries()].filter(([h,g])=>g).map(([h])=>h).join(" ")||"all",k=[...o.entries()].filter(([h,g])=>g).map(([h])=>h).join(" ")||"all";return n.jsxs("div",{className:"filters",children:[n.jsx(Vt,{expanded:r,setExpanded:f,title:n.jsx("input",{ref:d,type:"search",placeholder:"Filter (e.g. text, @tag)",spellCheck:!1,value:i,onChange:h=>{t(h.target.value)},onKeyDown:h=>{h.key==="Enter"&&m()}})}),n.jsxs("div",{className:"filter-summary",title:"Status: "+p+`
Projects: `+k,onClick:()=>f(!r),children:[n.jsx("span",{className:"filter-label",children:"Status:"})," ",p,n.jsx("span",{className:"filter-label",children:"Projects:"})," ",k]}),r&&n.jsxs("div",{className:"hbox",style:{marginLeft:14,maxHeight:200,overflowY:"auto"},children:[n.jsx("div",{className:"filter-list",children:[...e.entries()].map(([h,g])=>n.jsx("div",{className:"filter-entry",children:n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",checked:g,onClick:()=>{const v=new Map(e);v.set(h,!v.get(h)),s(v)}}),n.jsx("div",{children:h})]})},h))}),n.jsx("div",{className:"filter-list",children:[...o.entries()].map(([h,g])=>n.jsx("div",{className:"filter-entry",children:n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",checked:g,onClick:()=>{var T;const v=new Map(o);v.set(h,!v.get(h)),l(v);const B=(T=a==null?void 0:a.config)==null?void 0:T.configFile;B&&mt.setObject(B+":projects",[...v.entries()].filter(([y,W])=>W).map(([y])=>y))}}),n.jsx("div",{children:h||"untitled"})]})},h))})]})]})},pe=({tag:i,style:t,onClick:e})=>n.jsx("span",{className:it("tag",`tag-color-${ge(i)}`),onClick:e,style:{margin:"6px 0 0 6px",...t},title:`Click to filter by tag: ${i}`,children:i});function ge(i){let t=0;for(let e=0;e<i.length;e++)t=i.charCodeAt(e)+((t<<8)-t);return Math.abs(t%6)}const me=$t,we=({filterText:i,testModel:t,testServerConnection:e,testTree:s,runTests:o,runningState:l,watchAll:a,watchedTreeIds:m,setWatchedTreeIds:r,isLoading:f,onItemSelected:d,requestedCollapseAllCount:p,setFilterText:k,onRevealSource:h})=>{const[g,v]=c.useState({expandedItems:new Map}),[B,T]=c.useState(),[y,W]=c.useState(p);c.useEffect(()=>{if(y!==p){g.expandedItems.clear();for(const x of s.flatTreeItems())g.expandedItems.set(x.id,!1);W(p),T(void 0),v({...g});return}if(!l||l.itemSelectedByUser)return;let u;const R=x=>{var M;x.children.forEach(R),!u&&x.status==="failed"&&(x.kind==="test"&&l.testIds.has(x.test.id)||x.kind==="case"&&l.testIds.has((M=x.tests[0])==null?void 0:M.id))&&(u=x)};R(s.rootItem),u&&T(u.id)},[l,T,s,y,W,p,g,v]);const{selectedTreeItem:C}=c.useMemo(()=>{if(!t)return{selectedTreeItem:void 0};const u=B?s.treeItemById(B):void 0,R=_e(u,t);let x;return(u==null?void 0:u.kind)==="test"?x=u.test:(u==null?void 0:u.kind)==="case"&&u.tests.length===1&&(x=u.tests[0]),d({treeItem:u,testCase:x,testFile:R}),{selectedTreeItem:u}},[d,B,t,s]);c.useEffect(()=>{if(!f)if(a)e==null||e.watchNoReply({fileNames:s.fileNames()});else{const u=new Set;for(const R of m.value){const x=s.treeItemById(R),M=x==null?void 0:x.location.file;M&&u.add(M)}e==null||e.watchNoReply({fileNames:[...u]})}},[f,s,a,m,e]);const F=u=>{T(u.id),o("bounce-if-busy",s.collectTestIds(u))},A=(u,R)=>{if(u.preventDefault(),u.stopPropagation(),u.metaKey||u.ctrlKey){const x=i.split(" ");x.includes(R)?k(x.filter(M=>M!==R).join(" ").trim()):k((i+" "+R).trim())}else k((i.split(" ").filter(x=>!x.startsWith("@")).join(" ")+" "+R).trim())};return n.jsx(me,{name:"tests",treeState:g,setTreeState:v,rootItem:s.rootItem,dataTestId:"test-tree",render:u=>n.jsxs("div",{className:"hbox ui-mode-list-item",children:[n.jsxs("div",{className:"ui-mode-list-item-title",children:[n.jsx("span",{title:u.title,children:u.title}),u.kind==="case"?u.tags.map(R=>n.jsx(pe,{tag:R.slice(1),onClick:x=>A(x,R)},R)):null]}),!!u.duration&&u.status!=="skipped"&&n.jsx("div",{className:"ui-mode-list-item-time",children:Kt(u.duration)}),n.jsxs(H,{noMinHeight:!0,noShadow:!0,children:[n.jsx(L,{icon:"play",title:"Run",onClick:()=>F(u),disabled:!!l&&!l.completed}),n.jsx(L,{icon:"go-to-file",title:"Show source",onClick:h,style:u.kind==="group"&&u.subKind==="folder"?{visibility:"hidden"}:{}}),!a&&n.jsx(L,{icon:"eye",title:"Watch",onClick:()=>{m.value.has(u.id)?m.value.delete(u.id):m.value.add(u.id),r({...m})},toggled:m.value.has(u.id)})]})]}),icon:u=>Ht(u.status),selectedItem:C,onAccepted:F,onSelected:u=>{l&&(l.itemSelectedByUser=!0),T(u.id)},isError:u=>u.kind==="group"?u.hasLoadErrors:!1,autoExpandDepth:i?5:1,noItemsMessage:f?"Loading…":"No tests"})};function _e(i,t){if(!(!i||!t))return{file:i.location.file,line:i.location.line,column:i.location.column,source:{errors:t.loadErrors.filter(e=>{var s;return((s=e.location)==null?void 0:s.file)===i.location.file}).map(e=>({line:e.location.line,message:e.message})),content:void 0}}}function Se(i){return`.playwright-artifacts-${i}`}const ve=({item:i,rootDir:t,onOpenExternally:e,revealSource:s,pathSeparator:o})=>{var v,B;const[l,a]=c.useState(),[m,r]=c.useState(0),f=c.useRef(null),{outputDir:d}=c.useMemo(()=>({outputDir:i.testCase?xe(i.testCase):void 0}),[i]),[p,k]=c.useState(),h=c.useCallback(T=>k(ht(T)),[k]),g=p?l==null?void 0:l.model.actions.find(T=>ht(T)===p):void 0;return c.useEffect(()=>{var C,F;f.current&&clearTimeout(f.current);const T=(C=i.testCase)==null?void 0:C.results[0];if(!T){a(void 0);return}const y=T&&T.duration>=0&&T.attachments.find(A=>A.name==="trace");if(y&&y.path){ft(y.path).then(A=>a({model:A,isLive:!1}));return}if(!d){a(void 0);return}const W=[d,Se(T.workerIndex),"traces",`${(F=i.testCase)==null?void 0:F.id}.json`].join(o);return f.current=setTimeout(async()=>{try{const A=await ft(W);a({model:A,isLive:!0})}catch{a(void 0)}finally{r(m+1)}},500),()=>{f.current&&clearTimeout(f.current)}},[d,i,a,m,r]),n.jsx(qt,{model:l==null?void 0:l.model,showSourcesFirst:!0,rootDir:t,initialSelection:g,onSelectionChanged:h,fallbackLocation:i.testFile,isLive:l==null?void 0:l.isLive,status:(v=i.treeItem)==null?void 0:v.status,annotations:((B=i.testCase)==null?void 0:B.annotations)||[],onOpenExternally:e,revealSource:s},"workbench")},xe=i=>{var t;for(let e=i.parent;e;e=e.parent)if(e.project())return(t=e.project())==null?void 0:t.outputDir};async function ft(i){const t=new URLSearchParams;t.set("trace",i);const s=await(await fetch(`contexts?${t.toString()}`)).json();return new Yt(s)}let pt={cols:80,rows:24};const z={pending:[],clear:()=>{},write:i=>z.pending.push(i),resize:()=>{}},D=new URLSearchParams(window.location.search),be=D.get("ws"),_t=new URL(`../${be}`,window.location.toString());_t.protocol=window.location.protocol==="https:"?"wss:":"ws:";const b={args:D.getAll("arg"),grep:D.get("grep")||void 0,grepInvert:D.get("grepInvert")||void 0,projects:D.getAll("project"),workers:D.get("workers")||void 0,timeout:D.has("timeout")?+D.get("timeout"):void 0,headed:D.has("headed"),outputDir:D.get("outputDir")||void 0,updateSnapshots:D.get("updateSnapshots")||void 0,reporters:D.has("reporter")?D.getAll("reporter"):void 0,pathSeparator:D.get("pathSeparator")||"/"};b.updateSnapshots&&!["all","none","missing"].includes(b.updateSnapshots)&&(b.updateSnapshots=void 0);const gt=navigator.platform==="MacIntel",Te=({})=>{var dt;const[i,t]=c.useState(""),[e,s]=c.useState(!1),[o,l]=c.useState(new Map([["passed",!1],["failed",!1],["skipped",!1]])),[a,m]=c.useState(new Map),[r,f]=c.useState(),[d,p]=c.useState(),[k,h]=c.useState({}),[g,v]=c.useState(new Set),[B,T]=c.useState(!1),[y,W]=c.useState(),C=y&&!y.completed,[F,A]=tt("watch-all",!1),[u,R]=c.useState({value:new Set}),x=c.useRef(Promise.resolve()),M=c.useRef(new Set),[ot,St]=c.useState(0),[vt,xt]=c.useState(!1),[rt,nt]=c.useState(!0),[S,bt]=c.useState(),[Y,Tt]=c.useState(),[Q,kt]=c.useState(!1);c.useState(!1);const[jt,at]=c.useState(!1),Et=c.useCallback(()=>at(!0),[at]),yt=!1,[lt,ke]=c.useState(b.workers==="1"),[ct,je]=c.useState(b.headed),[ut,Ee]=c.useState(b.updateSnapshots==="all"),[It,Rt]=tt("show-route-actions",!0),[Bt,Ct]=Qt(),[Nt,Dt]=tt("screenshot-instead-of-snapshot",!1),Pt=c.useRef(null),X=c.useCallback(()=>{bt(new te(new ee(_t)))},[]);c.useEffect(()=>{var _;(_=Pt.current)==null||_.focus(),T(!0),X()},[X]),c.useEffect(()=>{if(!S)return;const _=[S.onStdio(w=>{if(w.buffer){const j=atob(w.buffer);z.write(j)}else z.write(w.text)}),S.onClose(()=>xt(!0))];return z.resize=(w,j)=>{pt={cols:w,rows:j},S.resizeTerminalNoReply({cols:w,rows:j})},()=>{for(const w of _)w.dispose()}},[S]),c.useEffect(()=>{if(!S)return;let _;const w=new ce({onUpdate:j=>{clearTimeout(_),_=void 0,j?f(w.asModel()):_||(_=setTimeout(()=>{f(w.asModel())},250))},onError:j=>{z.write((j.stack||j.value||"")+`
`)},pathSeparator:b.pathSeparator});return Tt(w),f(void 0),T(!0),R({value:new Set}),(async()=>{try{await S.initialize({interceptStdio:!0,watchTestDirs:!0});const{status:j,report:I}=await S.runGlobalSetup({outputDir:b.outputDir});if(w.processGlobalReport(I),j!=="passed")return;const N=await S.listTests({projects:b.projects,locations:b.args,grep:b.grep,grepInvert:b.grepInvert,outputDir:b.outputDir});w.processListReport(N.report),S.onReport(P=>{w.processTestReportEvent(P)});const{hasBrowsers:O}=await S.checkBrowsers({});nt(O)}finally{T(!1)}})(),()=>{clearTimeout(_)}},[S]),c.useEffect(()=>{if(!r)return;const{config:_,rootSuite:w}=r,j=_.configFile?mt.getObject(_.configFile+":projects",void 0):void 0,I=new Map(a);for(const N of I.keys())w.suites.find(O=>O.title===N)||I.delete(N);for(const N of w.suites)I.has(N.title)||I.set(N.title,!!(j!=null&&j.includes(N.title)));!j&&I.size&&![...I.values()].includes(!0)&&I.set(I.entries().next().value[0],!0),(a.size!==I.size||[...a].some(([N,O])=>I.get(N)!==O))&&m(I)},[a,r]),c.useEffect(()=>{C&&(r!=null&&r.progress)?p(r.progress):r||p(void 0)},[r,C]);const{testTree:Mt}=c.useMemo(()=>{if(!r)return{testTree:new st("",new $("","root"),[],a,b.pathSeparator)};const _=new st("",r.rootSuite,r.loadErrors,a,b.pathSeparator);return _.filterTree(i,o,C?y==null?void 0:y.testIds:void 0),_.sortAndPropagateStatus(),_.shortenRoot(),_.flattenForSingleProject(),v(_.testIds()),{testTree:_}},[i,r,o,a,v,y,C]),V=c.useCallback((_,w)=>{!S||!r||_==="bounce-if-busy"&&C||(M.current=new Set([...M.current,...w]),x.current=x.current.then(async()=>{var N,O,P;const j=M.current;if(M.current=new Set,!j.size)return;{for(const E of((N=r.rootSuite)==null?void 0:N.allTests())||[])if(j.has(E.id)){E.results=[];const U=E._createTestResult("pending");U[q]="scheduled"}f({...r})}const I="  ["+new Date().toLocaleTimeString()+"]";z.write("\x1B[2m—".repeat(Math.max(0,pt.cols-I.length))+I+"\x1B[22m"),p({total:0,passed:0,failed:0,skipped:0}),W({testIds:j}),await S.runTests({locations:b.args,grep:b.grep,grepInvert:b.grepInvert,testIds:[...j],projects:[...a].filter(([E,U])=>U).map(([E])=>E),workers:lt?"1":b.workers==="1"?void 0:b.workers,timeout:b.timeout,headed:ct,outputDir:b.outputDir,updateSnapshots:ut?"all":b.updateSnapshots,reporters:b.reporters,trace:"on"});for(const E of((O=r.rootSuite)==null?void 0:O.allTests())||[])((P=E.results[0])==null?void 0:P.duration)===-1&&(E.results=[]);f({...r}),W(E=>E?{...E,completed:!0}:void 0)}))},[a,C,r,S,lt,ct,ut]);c.useEffect(()=>{if(!S||!Y)return;const _=S.onTestFilesChanged(async w=>{if(x.current=x.current.then(async()=>{T(!0);try{const P=await S.listTests({projects:b.projects,locations:b.args,grep:b.grep,grepInvert:b.grepInvert,outputDir:b.outputDir});Y.processListReport(P.report)}catch(P){console.log(P)}finally{T(!1)}}),await x.current,w.testFiles.length===0)return;const j=Y.asModel(),I=new st("",j.rootSuite,j.loadErrors,a,b.pathSeparator),N=[],O=new Set(w.testFiles);if(F){const P=E=>{const U=E.location.file;U&&O.has(U)&&N.push(...I.collectTestIds(E)),E.kind==="group"&&E.subKind==="folder"&&E.children.forEach(P)};P(I.rootItem)}else for(const P of u.value){const E=I.treeItemById(P),U=E==null?void 0:E.location.file;U&&O.has(U)&&N.push(...I.collectTestIds(E))}V("queue-if-busy",new Set(N))});return()=>_.dispose()},[V,S,F,u,Y,a]),c.useEffect(()=>{if(!S)return;const _=w=>{w.code==="Backquote"&&w.ctrlKey?(w.preventDefault(),s(!e)):w.code==="F5"&&w.shiftKey?(w.preventDefault(),S==null||S.stopTestsNoReply({})):w.code==="F5"&&(w.preventDefault(),V("bounce-if-busy",g))};return addEventListener("keydown",_),()=>{removeEventListener("keydown",_)}},[V,X,S,g,e]);const J=c.useRef(null),Lt=c.useCallback(_=>{var w;_.preventDefault(),_.stopPropagation(),(w=J.current)==null||w.showModal()},[]),Z=c.useCallback(_=>{var w;_.preventDefault(),_.stopPropagation(),(w=J.current)==null||w.close()},[]),Ft=c.useCallback(_=>{Z(_),s(!0),S==null||S.installBrowsers({}).then(async()=>{s(!1);const{hasBrowsers:w}=await(S==null?void 0:S.checkBrowsers({}));nt(w)})},[Z,S]);return n.jsxs("div",{className:"vbox ui-mode",children:[!rt&&n.jsxs("dialog",{ref:J,children:[n.jsxs("div",{className:"title",children:[n.jsx("span",{className:"codicon codicon-lightbulb"}),"Install browsers"]}),n.jsxs("div",{className:"body",children:["Playwright did not find installed browsers.",n.jsx("br",{}),"Would you like to run `playwright install`?",n.jsx("br",{}),n.jsx("button",{className:"button",onClick:Ft,children:"Install"}),n.jsx("button",{className:"button secondary",onClick:Z,children:"Dismiss"})]})]}),vt&&n.jsxs("div",{className:"disconnected",children:[n.jsx("div",{className:"title",children:"UI Mode disconnected"}),n.jsxs("div",{children:[n.jsx("a",{href:"#",onClick:()=>window.location.href="/",children:"Reload the page"})," to reconnect"]})]}),n.jsx(Xt,{sidebarSize:250,minSidebarSize:150,orientation:"horizontal",sidebarIsFirst:!0,settingName:"testListSidebar",main:n.jsxs("div",{className:"vbox",children:[n.jsxs("div",{className:it("vbox",!e&&"hidden"),children:[n.jsxs(H,{children:[n.jsx("div",{className:"section-title",style:{flex:"none"},children:"Output"}),n.jsx(L,{icon:"circle-slash",title:"Clear output",onClick:()=>z.clear()}),n.jsx("div",{className:"spacer"}),n.jsx(L,{icon:"close",title:"Close",onClick:()=>s(!1)})]}),n.jsx(ue,{source:z})]}),n.jsx("div",{className:it("vbox",e&&"hidden"),children:n.jsx(ve,{pathSeparator:b.pathSeparator,item:k,rootDir:(dt=r==null?void 0:r.config)==null?void 0:dt.rootDir,revealSource:jt,onOpenExternally:_=>S==null?void 0:S.openNoReply({location:{file:_.file,line:_.line,column:_.column}})})})]}),sidebar:n.jsxs("div",{className:"vbox ui-mode-sidebar",children:[n.jsxs(H,{noShadow:!0,noMinHeight:!0,children:[n.jsx("img",{src:"playwright-logo.svg",alt:"Playwright logo"}),n.jsx("div",{className:"section-title",children:"Playwright"}),n.jsx(L,{icon:"refresh",title:"Reload",onClick:()=>X(),disabled:C||B}),n.jsx(L,{icon:"terminal",title:"Toggle output — "+(gt?"⌃`":"Ctrl + `"),toggled:e,onClick:()=>{s(!e)}}),!rt&&n.jsx(L,{icon:"lightbulb-autofix",style:{color:"var(--vscode-list-warningForeground)"},title:"Playwright browsers are missing",onClick:Lt})]}),n.jsx(fe,{filterText:i,setFilterText:t,statusFilters:o,setStatusFilters:l,projectFilters:a,setProjectFilters:m,testModel:r,runTests:()=>V("bounce-if-busy",g)}),n.jsxs(H,{noMinHeight:!0,children:[!C&&!d&&n.jsx("div",{className:"section-title",children:"Tests"}),!C&&d&&n.jsx("div",{"data-testid":"status-line",className:"status-line",children:n.jsxs("div",{children:[d.passed,"/",d.total," passed (",d.passed/d.total*100|0,"%)"]})}),C&&d&&n.jsx("div",{"data-testid":"status-line",className:"status-line",children:n.jsxs("div",{children:["Running ",d.passed,"/",y.testIds.size," passed (",d.passed/y.testIds.size*100|0,"%)"]})}),n.jsx(L,{icon:"play",title:"Run all — F5",onClick:()=>V("bounce-if-busy",g),disabled:C||B}),n.jsx(L,{icon:"debug-stop",title:"Stop — "+(gt?"⇧F5":"Shift + F5"),onClick:()=>S==null?void 0:S.stopTests({}),disabled:!C||B}),n.jsx(L,{icon:"eye",title:"Watch all",toggled:F,onClick:()=>{R({value:new Set}),A(!F)}}),n.jsx(L,{icon:"collapse-all",title:"Collapse all",onClick:()=>{St(ot+1)}})]}),n.jsx(we,{filterText:i,testModel:r,testTree:Mt,testServerConnection:S,runningState:y,runTests:V,onItemSelected:h,watchAll:F,watchedTreeIds:u,setWatchedTreeIds:R,isLoading:B,requestedCollapseAllCount:ot,setFilterText:t,onRevealSource:Et}),yt,n.jsxs(H,{noShadow:!0,noMinHeight:!0,className:"settings-toolbar",onClick:()=>kt(!Q),children:[n.jsx("span",{className:`codicon codicon-${Q?"chevron-down":"chevron-right"}`,style:{marginLeft:5},title:Q?"Hide Settings":"Show Settings"}),n.jsx("div",{className:"section-title",children:"Settings"})]}),Q&&n.jsx(Gt,{settings:[{value:Bt,set:Ct,title:"Dark mode"},{value:It,set:Rt,title:"Show route actions"},{value:Nt,set:Dt,title:"Show screenshot instead of snapshot"}]})]})})]})};(async()=>{if(Jt(),window.location.protocol!=="file:"){if(window.location.href.includes("isUnderTest=true")&&await new Promise(i=>setTimeout(i,1e3)),!navigator.serviceWorker)throw new Error(`Service workers are not supported.
Make sure to serve the website (${window.location}) via HTTPS or localhost.`);navigator.serviceWorker.register("sw.bundle.js"),navigator.serviceWorker.controller||await new Promise(i=>{navigator.serviceWorker.oncontrollerchange=()=>i()}),setInterval(function(){fetch("ping")},1e4)}Zt(document.querySelector("#root")).render(n.jsx(Te,{}))})();
